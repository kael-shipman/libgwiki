<!DOCTYPE html>
<html>
<head>
    <meta charset="utf8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=2.0">
    <title>GWiki</title>
    <link type="text/css" rel="stylesheet" href="/assets/base.css">
    <link type="text/css" rel="stylesheet" href="/assets/Gwiki.css">
    <script type="text/javascript" src="/vendor/stackexchange/pagedown/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/assets/Utils.js"></script>
    <script type="text/javascript" src="/assets/Gwiki.js"></script>
    <script type="text/javascript" src="/assets/GwikiUI.js"></script>

    <script type="text/javascript">
        function init() {
            Gwiki.consumableTypes.push('application/vnd.google-apps.spreadsheet');
            var ui = new GwikiUI({
                root : document.getElementsByClassName('gwiki-ui')[0],
                markdownParser: new Markdown.Converter()
            });

            gapi.client.init({
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
                clientId: '885013016646-5lar99giu3cmhqortaivcm8mcd9420os.apps.googleusercontent.com',
                scope: 'https://www.googleapis.com/auth/drive.readonly'
            }).then(function () {
                // Instantiate worker objects
                window.gwiki = new Gwiki();

                ui.subscribeListeners(window.gwiki);

                // Sign in
                var manageSignin = function (signedIn) {
                    if (signedIn) {
                        if (!window.gwiki.initialized) gwiki.init();
                    } else {
                        gapi.auth2.getAuthInstance().signIn();
                    }
                }
                // Listen for changes in authentication
                gapi.auth2.getAuthInstance().isSignedIn.listen(manageSignin);
                // Kick everything off
                manageSignin(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
        }
    </script>
</head>
<body>
<div class="gwiki-ui">
</div>
<script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};gapi.load('client:auth2', init);"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>
</body>
</html>
